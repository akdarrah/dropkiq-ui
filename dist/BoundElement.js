"use strict";import"core-js/modules/es.array.concat";import"core-js/modules/es.array.for-each";import"core-js/modules/es.array.join";import"core-js/modules/es.array.slice";import"core-js/modules/es.object.to-string";import"core-js/modules/es.regexp.exec";import"core-js/modules/es.regexp.to-string";import"core-js/modules/es.string.replace";import"core-js/modules/es.string.split";import"core-js/modules/web.dom-collections.for-each";function _typeof(e){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}function _createClass(e,t,n){return t&&_defineProperties(e.prototype,t),n&&_defineProperties(e,n),e}Object.defineProperty(exports,"__esModule",{value:!0});var BoundElement=function(){function e(t,n,o){_classCallCheck(this,e),this.element=t,this.window=n,this.document=o,this.isContenteditable=this.element.isContentEditable,this.isCodeMirror="object"===_typeof(this.element.doc),this.isAceEditor="object"===_typeof(this.element.renderer),this.cachedOnBlurRange=null}return _createClass(e,[{key:"setFocus",value:function(){if(this.isCodeMirror)this.element.focus();else if(this.isAceEditor)this.element.focus();else{var e=new Event("focus");this.element.dispatchEvent(e)}}},{key:"caretPositionWithDocumentInfo",value:function(){return this.isCodeMirror?this.caretPositionWithDocumentInfoForCodeMirror():this.isAceEditor?this.caretPositionWithDocumentInfoForAceEditor():this.isContenteditable?this.caretPositionWithDocumentInfoForContenteditable():this.caretPositionWithDocumentInfoForInput()}},{key:"setCaretPosition",value:function(e,t,n,o,i){var r=e-i.length;if(this.isCodeMirror){var s=this.element.getValue(),l=(c=this.getRowAndColumnForPosition(s,r)).column+t,a=c.column+n;this.element.doc.setSelection({line:c.row,ch:l},{line:c.row,ch:a})}else if(this.isAceEditor){var c;s=this.element.getValue(),l=(c=this.getRowAndColumnForPosition(s,r)).column+t,a=c.column+n;this.element.getSelection().setSelectionRange({start:{row:c.row,column:l},end:{row:c.row,column:a}},!1)}else if(this.isContenteditable){var u=this.document.createRange(),d=this.window.getSelection();u.setStart(o,t-i.length),u.setEnd(o,n-i.length),d.removeAllRanges(),d.addRange(u)}else{var h=r+t,m=r+n;this.element.setSelectionRange(h,m)}}},{key:"getRowAndColumnForPosition",value:function(e,t){var n=e.slice(0,t).split(/\r?\n/),o=n.length-1;return{row:o,column:n[o].length}}},{key:"getCaretPosition",value:function(){if(this.isCodeMirror){var e=this.element.cursorCoords(!0),t=this.element.display.lineDiv,n=this.window.getComputedStyle?getComputedStyle(t):t.currentStyle,o=this.element.getCursor(!0).line+1;return{top:this.element.heightAtLine(o),left:e.left+parseInt(n.borderLeftWidth)}}if(this.isAceEditor){var i=this.element.renderer.$cursorLayer.element.getElementsByClassName("ace_cursor")[0].getBoundingClientRect();return{top:i.top+i.height,left:i.left}}if(this.isContenteditable){var r=this.window.getSelection().getRangeAt(0);return this.getContentEditableCaretPosition(r.startOffset)}var s=this.element.selectionStart;return this.getTextAreaOrInputUnderlinePosition(this.element,s,!1)}},{key:"insertTextAtCaret",value:function(e){if(this.isCodeMirror){var t=this.element.getCursor(!0);this.element.doc.replaceRange(e,t,t)}else{if(!this.isAceEditor)return this.isContenteditable?this.insertTextForContenteditable(e):this.insertTextForInput(e);var n=this.element.getCursorPosition();this.element.session.insert(n,e)}}},{key:"setExpiringCachedOnBlurRange",value:function(e){var t=this;this.isContenteditable&&(this.cachedOnBlurRange=e,setTimeout((function(){t.cachedOnBlurRange=null}),200))}},{key:"insertTextForContenteditable",value:function(e){var t,n;t=this.window.getSelection(),this.cachedOnBlurRange?(n=this.cachedOnBlurRange,this.cachedOnBlurRange=null):n=t.getRangeAt(0),n.deleteContents();var o=this.document.createTextNode(e);return n.insertNode(o),n.selectNodeContents(o),n.collapse(!1),t.removeAllRanges(),t.addRange(n),o}},{key:"insertTextForInput",value:function(e){var t=this.element,n=t.scrollTop,o=t.selectionStart,i=t.value.substring(0,o),r=t.value.substring(t.selectionEnd,t.value.length);return t.value=i+e+r,o+=e.length,t.selectionStart=o,t.selectionEnd=o,t.focus(),t.scrollTop=n,t}},{key:"caretPositionWithDocumentInfoForInput",value:function(){var e=this.element.selectionStart,t=this.element.value;return{leftText:t.slice(0,e),selectionStart:e,rightText:t.slice(e,t.length),allText:t}}},{key:"caretPositionWithDocumentInfoForContenteditable",value:function(){var e=this.window.getSelection().getRangeAt(0),t=e.cloneRange();t.setStart(this.element,0),t.setEnd(e.startContainer,e.startOffset);var n=this.captureRangeText(t),o=e.cloneRange();o.selectNodeContents(this.element),o.setStart(e.startContainer,e.startOffset);var i=this.captureRangeText(o);return{leftText:n,selectionStart:n.length,rightText:i,allText:n+i}}},{key:"caretPositionWithDocumentInfoForAceEditor",value:function(){var e=this.element.getValue(),t=this.element.getCursorPosition(),n=t.row,o=t.column;return this.caretPositionWithDocumentInfoForValueRowAndColumn(e,n,o)}},{key:"caretPositionWithDocumentInfoForCodeMirror",value:function(){var e=this.element.getValue(),t=this.element.getCursor(!0),n=t.line,o=t.ch;return this.caretPositionWithDocumentInfoForValueRowAndColumn(e,n,o)}},{key:"caretPositionWithDocumentInfoForValueRowAndColumn",value:function(e,t,n){var o=[],i=[];e.split(/\r?\n/).forEach((function(e,r){r<t?o.push(e):r===t?(o.push(e.slice(0,n)),i.push(e.slice(n,e.length))):r>t&&i.push(e)}));var r=o.join("\n"),s=i.join("\n");return{leftText:r,selectionStart:r.length,rightText:s,allText:r+s}}},{key:"captureRangeText",value:function(e){var t=e.cloneContents(),n=this.document.createElement("div");n.setAttribute("style","position: absolute; left: -10000px; top: -10000px"),n.setAttribute("contenteditable","true"),n.appendChild(t),this.document.body.appendChild(n);var o=n.innerText;return n.remove(),o}},{key:"getTextAreaOrInputUnderlinePosition",value:function(e,t,n){var o=null!==this.window.mozInnerScreenX,i=this.document.createElement("div");i.id="input-textarea-caret-position-mirror-div",this.document.body.appendChild(i);var r=i.style,s=this.window.getComputedStyle?getComputedStyle(e):e.currentStyle;r.whiteSpace="pre-wrap","INPUT"!==e.nodeName&&(r.wordWrap="break-word"),r.position="absolute",r.visibility="hidden",["direction","boxSizing","width","height","overflowX","overflowY","borderTopWidth","borderRightWidth","borderBottomWidth","borderLeftWidth","paddingTop","paddingRight","paddingBottom","paddingLeft","fontStyle","fontVariant","fontWeight","fontStretch","fontSize","fontSizeAdjust","lineHeight","fontFamily","textAlign","textTransform","textIndent","textDecoration","letterSpacing","wordSpacing"].forEach((function(e){r[e]=s[e]})),o?(r.width="".concat(parseInt(s.width)-2,"px"),e.scrollHeight>parseInt(s.height)&&(r.overflowY="scroll")):r.overflow="hidden",i.textContent=e.value.substring(0,t),"INPUT"===e.nodeName&&(i.textContent=i.textContent.replace(/\s/g," "));var l=this.document.createElement("span");l.textContent=e.value.substring(t)||".",i.appendChild(l);var a,c,u=e.getBoundingClientRect(),d=this.document.documentElement,h=(this.window.pageXOffset||d.scrollLeft)-(d.clientLeft||0),m=(this.window.pageYOffset||d.scrollTop)-(d.clientTop||0);a=u.top,c=u.left;var f={top:a+m+l.offsetTop+parseInt(s.borderTopWidth)+parseInt(s.fontSize)-e.scrollTop,left:c+h+l.offsetLeft+parseInt(s.borderLeftWidth)};return this.document.body.removeChild(i),f}},{key:"getContentEditableCaretPosition",value:function(e){var t,n,o="sel_".concat((new Date).getTime(),"_").concat(Math.random().toString().substr(2)),i=this.window.getSelection(),r=i.getRangeAt(0);(n=this.document.createRange()).setStart(i.anchorNode,e),n.setEnd(i.anchorNode,e),n.collapse(!1),(t=this.document.createElement("span")).id=o,t.appendChild(this.document.createTextNode("\ufeff")),n.insertNode(t),i.removeAllRanges(),i.addRange(r);var s=t.getBoundingClientRect(),l=this.document.documentElement,a=(this.window.pageXOffset||l.scrollLeft)-(l.clientLeft||0),c=(this.window.pageYOffset||l.scrollTop)-(l.clientTop||0),u={left:s.left+a,top:s.top+t.offsetHeight+c};return t.parentNode.removeChild(t),u}}]),e}();exports.BoundElement=BoundElement;