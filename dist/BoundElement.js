"use strict";Object.defineProperty(exports,"__esModule",{value:!0});class BoundElement{constructor(t,e,n){this.element=t,this.window=e,this.document=n,this.isContenteditable=this.element.isContentEditable}caretPositionWithDocumentInfo(){return this.isContenteditable?this.caretPositionWithDocumentInfoForContenteditable():this.caretPositionWithDocumentInfoForInput()}setCaretPosition(t,e){if(this.isContenteditable){var n=this.document.createRange(),o=this.window.getSelection();n.setStart(e,0),n.collapse(!0),o.removeAllRanges(),o.addRange(n)}else this.element.setSelectionRange(t,t)}getCaretPosition(){if(this.isContenteditable){let t=this.window.getSelection().getRangeAt(0);return this.getContentEditableCaretPosition(t.startOffset)}{let t=this.element.selectionStart;return this.getTextAreaOrInputUnderlinePosition(this.element,t,!1)}}insertTextAtCaret(t){return this.isContenteditable?this.insertTextForContenteditable(t):this.insertTextForInput(t)}insertTextForContenteditable(t){var e,n;(n=(e=this.window.getSelection()).getRangeAt(0)).deleteContents();var o=this.document.createTextNode(t);return n.insertNode(o),n.selectNodeContents(o),n.collapse(!1),e.removeAllRanges(),e.addRange(n),o}insertTextForInput(t){var e=this.element,n=e.scrollTop,o=e.selectionStart,i=e.value.substring(0,o),r=e.value.substring(e.selectionEnd,e.value.length);return e.value=i+t+r,o+=t.length,e.selectionStart=o,e.selectionEnd=o,e.focus(),e.scrollTop=n,e}caretPositionWithDocumentInfoForInput(){let t=this.element.selectionStart,e=this.element.value;return{leftText:e.slice(0,t),selectionStart:t,rightText:e.slice(t,e.length),allText:e}}caretPositionWithDocumentInfoForContenteditable(){let t=this.window.getSelection().getRangeAt(0),e=t.cloneRange();e.setStart(this.element,0),e.setEnd(t.startContainer,t.startOffset);let n=this.captureRangeText(e),o=t.cloneRange();o.selectNodeContents(this.element),o.setStart(t.startContainer,t.startOffset);let i=this.captureRangeText(o);return{leftText:n,selectionStart:n.length,rightText:i,allText:n+i}}captureRangeText(t){let e=t.cloneContents(),n=this.document.createElement("div");n.setAttribute("style","position: absolute; left: -10000px; top: -10000px"),n.setAttribute("contenteditable","true"),n.appendChild(e),this.document.body.appendChild(n);let o=n.innerText;return n.remove(),o}getTextAreaOrInputUnderlinePosition(t,e,n){let o=null!==this.window.mozInnerScreenX,i=this.document.createElement("div");i.id="input-textarea-caret-position-mirror-div",this.document.body.appendChild(i);let r=i.style,s=this.window.getComputedStyle?getComputedStyle(t):t.currentStyle;r.whiteSpace="pre-wrap","INPUT"!==t.nodeName&&(r.wordWrap="break-word"),r.position="absolute",r.visibility="hidden",["direction","boxSizing","width","height","overflowX","overflowY","borderTopWidth","borderRightWidth","borderBottomWidth","borderLeftWidth","paddingTop","paddingRight","paddingBottom","paddingLeft","fontStyle","fontVariant","fontWeight","fontStretch","fontSize","fontSizeAdjust","lineHeight","fontFamily","textAlign","textTransform","textIndent","textDecoration","letterSpacing","wordSpacing"].forEach(t=>{r[t]=s[t]}),o?(r.width=`${parseInt(s.width)-2}px`,t.scrollHeight>parseInt(s.height)&&(r.overflowY="scroll")):r.overflow="hidden",i.textContent=t.value.substring(0,e),"INPUT"===t.nodeName&&(i.textContent=i.textContent.replace(/\s/g," "));let l=this.document.createElement("span");l.textContent=t.value.substring(e)||".",i.appendChild(l);let a=t.getBoundingClientRect(),d=this.document.documentElement,c=(this.window.pageXOffset||d.scrollLeft)-(d.clientLeft||0),h=(this.window.pageYOffset||d.scrollTop)-(d.clientTop||0),u=0,p=0;u=a.top,p=a.left;let g={top:u+h+l.offsetTop+parseInt(s.borderTopWidth)+parseInt(s.fontSize)-t.scrollTop,left:p+c+l.offsetLeft+parseInt(s.borderLeftWidth)};return this.document.body.removeChild(i),g}getContentEditableCaretPosition(t){let e,n,o=`sel_${(new Date).getTime()}_${Math.random().toString().substr(2)}`,i=this.window.getSelection(),r=i.getRangeAt(0);n=this.document.createRange(),n.setStart(i.anchorNode,t),n.setEnd(i.anchorNode,t),n.collapse(!1),e=this.document.createElement("span"),e.id=o,e.appendChild(this.document.createTextNode("\ufeff")),n.insertNode(e),i.removeAllRanges(),i.addRange(r);let s=e.getBoundingClientRect(),l=this.document.documentElement,a=(this.window.pageXOffset||l.scrollLeft)-(l.clientLeft||0),d=(this.window.pageYOffset||l.scrollTop)-(l.clientTop||0),c=0,h=0;c=s.left,h=s.top;let u={left:c+a,top:h+e.offsetHeight+d};return e.parentNode.removeChild(e),u}}exports.BoundElement=BoundElement;