"use strict";Object.defineProperty(exports,"__esModule",{value:!0});const ScopeCapture_1=require("./ScopeCapture"),value_1=require("./liquidjs/src/template/value");class LivePreviewer{constructor(e,t,s,i,a){this.path=e,this.suggestions=t,this.templates=s,this.caretToken=i,this.dataSchema=a}suggestionsWithPreviews(){return Object.keys(this.suggestions).forEach(e=>{let t=this.suggestions[e],s=this.constructLiquidStatementForSuggestion(e);this.modifyCaretTokenInTemplates(s);let i=new ScopeCapture_1.ScopeCapture(this.templates,this.caretToken,this.dataSchema);i.capture(this.dataSchema.scope);let a=i.getCapturedRendered();t.preview=a}),this.suggestions}constructLiquidStatementForSuggestion(e){let t=(""+this.caretToken.raw).replace("{{","").replace("}}","").split("|"),s=(t.shift(),[...this.path]);s.push(e);let i=s.join(".");return t.unshift(i),t.join(" | ")}modifyCaretTokenInTemplates(e,t=this.templates){t.forEach(t=>{t.token===this.caretToken&&(t.value=new value_1.Value(e,!1)),t.impl&&t.impl.templates&&this.modifyCaretTokenInTemplates(e,t.impl.templates)})}}exports.LivePreviewer=LivePreviewer;