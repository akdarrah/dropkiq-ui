"use strict";Object.defineProperty(exports,"__esModule",{value:!0});const assert_1=require("../../util/assert"),lexical_1=require("../../parser/lexical"),types_1=require("../../types"),block_mode_1=require("../../context/block-mode"),staticFileRE=/\S+/;exports.default={parse:function(e,t){let s=staticFileRE.exec(e.args);s&&(this.staticLayout=s[0]),s=lexical_1.value.exec(e.args),s&&(this.layout=s[0]),this.tpls=this.liquid.parser.parse(t)},render:function*(e,t,s){const i=e.opts.dynamicPartials?yield new types_1.Expression(this.layout).value(e):this.staticLayout;assert_1.assert(i,"cannot apply layout with empty filename"),e.setRegister("blockMode",block_mode_1.default.STORE);const l=e.getRegister("blocks"),r=this.liquid.renderer,a=yield r.renderTemplates(this.tpls,e);void 0===l[""]&&(l[""]=a);const o=yield this.liquid._parseFile(i,e.opts,e.sync);e.push(t),e.setRegister("blockMode",block_mode_1.default.OUTPUT);const c=yield r.renderTemplates(o,e);e.pop(),s.write(c)}};