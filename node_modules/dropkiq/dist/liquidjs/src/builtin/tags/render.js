"use strict";Object.defineProperty(exports,"__esModule",{value:!0});const assert_1=require("../../util/assert"),types_1=require("../../types"),lexical_1=require("../../parser/lexical"),block_mode_1=require("../../context/block-mode"),staticFileRE=/[^\s,]+/,withRE=new RegExp(`with\\s+(${lexical_1.value.source})`);exports.default={parse:function(e){let t=staticFileRE.exec(e.args);t&&(this.staticValue=t[0]),t=lexical_1.value.exec(e.args),t&&(this.value=t[0]),t=withRE.exec(e.args),t&&(this.with=t[1])},render:function*(e,t,s){let i;if(e.opts.dynamicPartials)if(lexical_1.quotedLine.exec(this.value)){const t=this.value.slice(1,-1);i=yield this.liquid._parseAndRender(t,e.getAll(),e.opts,e.sync)}else i=yield new types_1.Expression(this.value).value(e);else i=this.staticValue;assert_1.assert(i,"cannot render with empty filename");const l=e.getRegister("blocks"),r=e.getRegister("blockMode"),a=new types_1.Context({},e.opts,e.sync);a.setRegister("blocks",{}),a.setRegister("blockMode",block_mode_1.default.OUTPUT),this.with&&(t[i]=yield new types_1.Expression(this.with).evaluate(e)),a.push(t);const c=yield this.liquid._parseFile(i,a.opts,a.sync);yield this.liquid.renderer.renderTemplates(c,a,s),a.setRegister("blocks",l),a.setRegister("blockMode",r)}};